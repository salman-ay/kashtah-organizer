<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙƒØ´ØªØ© | Ø¬Ù‡Ù‘Ø² ÙƒØ´ØªØªÙƒ</title>
    <style>
        :root {
            --primary: #2D6A4F;
            --accent: #D8F3DC;
            --text: #1B4332;
            --bg: #F8F9FA;
            --white: #FFFFFF;
            --danger: #e63946;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: var(--white);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { 
            font-size: 1.4rem; /* Increased slightly for Arabic */
            font-weight: 800; 
            color: var(--primary); 
            cursor: pointer;
        }
        
        .back-btn { font-size: 1.5rem; cursor: pointer; border: none; background: none; padding: 0;}

        .screen {
            display: none;
            flex: 1;
            padding: 20px;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }
        .screen.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Buttons */
        .btn-main {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(45, 106, 79, 0.2);
        }

        .action-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            flex: 1;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .btn-secondary.active-edit {
            background-color: var(--primary);
            color: white;
        }

        /* Cards & Lists */
        .card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            border: 1px solid #eee;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .card:active { transform: scale(0.98); }
        .card h3 { font-size: 1.1rem; margin: 0 0 5px 0; }
        .card p { color: #666; font-size: 0.85rem; margin: 0; }
        .emoji-icon { font-size: 2rem; }

        /* Saved List Item */
        .saved-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .saved-info h4 { margin: 0 0 5px 0; }
        .saved-info span { font-size: 0.8rem; color: #888; }
        .delete-saved-btn { color: var(--danger); background: none; border: none; font-size: 1.2rem; padding: 10px; cursor: pointer;}

        /* List Items */
        .list-section { margin-bottom: 25px; }
        .section-title { 
            font-size: 0.95rem; 
            color: var(--primary); 
            margin-bottom: 10px; 
            font-weight: bold;
            background: #eef5f2;
            padding: 5px 10px;
            border-radius: 8px;
            display: inline-block;
        }
        
        .list-item {
            background: white;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .list-item:first-child { border-top-left-radius: 12px; border-top-right-radius: 12px; }
        .list-item:last-child { border-bottom: none; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }

        /* Edit Mode Styles */
        .delete-btn {
            color: var(--danger);
            cursor: pointer;
            font-weight: bold;
            padding: 5px 10px;
        }
        .add-row {
            display: flex;
            padding: 10px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
            gap: 10px;
        }
        .add-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .add-btn-small {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            width: 35px;
            cursor: pointer;
        }

        input[type="number"] {
            width: 100%; padding: 15px; font-size: 1.5rem; text-align: center;
            border: 2px solid #ddd; border-radius: 12px; margin: 20px 0; box-sizing: border-box;
        }

        .hidden { display: none !important; }
        .empty-state { text-align: center; padding: 30px; color: #aaa; background: #f0f0f0; border-radius: 12px; margin-top: 10px; }
    </style>
</head>
<body>

    <header id="app-header">
        <button class="back-btn hidden" onclick="goBack()">â†</button>
        <div class="logo" onclick="goToHome()">ÙƒØ´ØªØ© â›º</div>
        <div style="width: 24px;"></div>
    </header>

    <div id="home-screen" class="screen active">
        <div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
            <span style="font-size: 3.5rem;">ğŸ•ï¸</span>
            <h1>Ø¬Ù‡Ù‘Ø² ÙƒØ´ØªØªÙƒ</h1>
            <p style="color: #666;">Ø±ØªÙ‘Ø¨ Ø£ØºØ±Ø§Ø¶Ùƒ ÙˆÙ„Ø§ ØªÙ†Ø³Ù‰ Ø´ÙŠ</p>
        </div>

        <button class="btn-main" onclick="nextScreen('type-screen')" style="margin-top:0; margin-bottom: 30px;">â• Ø¬Ù‡Ù‘Ø² ÙƒØ´ØªØ© Ø¬Ø¯ÙŠØ¯Ø©</button>

        <h3 style="margin-bottom: 10px;">ÙƒØ´Ø§ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ğŸ“‚</h3>
        <div id="saved-list-container">
            </div>
    </div>

    <div id="type-screen" class="screen">
        <h2>ÙˆØ´ Ù†ÙˆØ¹ Ø§Ù„ÙƒØ´ØªØ©ØŸ</h2>
        <div style="margin-top: 20px;">
            <div class="card" onclick="selectType('land')">
                <span class="emoji-icon">ğŸŒµ</span>
                <div><h3>ÙƒØ´ØªØ© Ø¨Ø±</h3><p>Ø®Ù„Ø§Ø¡ØŒ Ø±Ù…Ù„ØŒ ÙˆØ¬Ù„Ø³Ø© Ø£Ø±Ø¶ÙŠØ©</p></div>
            </div>
            <div class="card" onclick="selectType('sea')">
                <span class="emoji-icon">ğŸ–ï¸</span>
                <div><h3>ÙƒØ´ØªØ© Ø¨Ø­Ø±</h3><p>Ø´Ø§Ø·Ø¦ØŒ Ø±Ø·ÙˆØ¨Ø©ØŒ ÙˆØ¬Ù„Ø³Ø© ÙƒØ±Ø§Ø³ÙŠ</p></div>
            </div>
            <div class="card" onclick="selectType('chalet')">
                <span class="emoji-icon">ğŸ¡</span>
                <div><h3>Ø´Ø§Ù„ÙŠÙ‡ / Ø§Ø³ØªØ±Ø§Ø­Ø©</h3><p>Ù…ÙƒØ§Ù† Ù…Ø¬Ù‡Ø²ØŒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù…ØªÙˆÙØ±Ø©</p></div>
            </div>
        </div>
    </div>

    <div id="style-screen" class="screen">
        <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙƒÙ„ ÙˆØ§Ù„Ø´Ø±Ø¨ØŸ</h2>
        <div style="margin-top: 20px;">
            <div class="card" onclick="selectStyle('cooking')">
                <span class="emoji-icon">ğŸ³</span>
                <div><h3>Ù…Ø¹ Ø·Ø¨Ø® ÙˆÙ†ÙØ®</h3><p>ØºØ¯Ø§Ø¡/Ø¹Ø´Ø§Ø¡ØŒ Ù‚Ø¯ÙˆØ±ØŒ ÙˆÙ…ÙƒÙˆÙ†Ø§Øª</p></div>
            </div>
            <div class="card" onclick="selectStyle('prep_drinks')">
                <span class="emoji-icon">ğŸ”¥</span>
                <div><h3>Ø¨Ø¯ÙˆÙ† Ø·Ø¨Ø® (ØªØ­Ø¶ÙŠØ± Ù‚Ù‡ÙˆØ©)</h3><p>Ø¨Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø¯Ù„Ø© ÙˆØ§Ù„Ù…Ø¹Ø§Ù…ÙŠÙ„ ÙˆÙ†Ø¶Ø¨Ø·Ù‡Ø§</p></div>
            </div>
            <div class="card" onclick="selectStyle('ready_drinks')">
                <span class="emoji-icon">â˜•</span>
                <div><h3>Ø¨Ø¯ÙˆÙ† Ø·Ø¨Ø® (Ø¬Ø§Ù‡Ø²)</h3><p>Ù†Ø¬ÙŠØ¨ Ø§Ù„ØªØ±Ø§Ù…Ø³ Ø¬Ø§Ù‡Ø²Ø© Ù…Ø¹Ù†Ø§</p></div>
            </div>
        </div>
    </div>

    <div id="count-screen" class="screen">
        <h2>ÙƒÙ… Ø¹Ø¯Ø¯ÙƒÙ…ØŸ</h2>
        <p style="color: #666;">Ø¹Ø´Ø§Ù† Ù†Ø¶Ø¨Ø· Ù„Ùƒ Ø§Ù„ÙƒÙ…ÙŠØ§Øª (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</p>
        <input type="number" id="people-count" value="4" min="1">
        <button class="btn-main" onclick="generateNewList()">Ø¬Ù‡Ù‘Ø² Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸš€</button>
    </div>

    <div id="list-screen" class="screen">
        <div class="action-bar">
            <button class="btn-secondary" onclick="toggleEditMode()" id="edit-btn">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn-secondary" onclick="saveCurrentList()">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="btn-secondary" onclick="copyToClipboard()">ğŸ“¤ Ù†Ø³Ø®</button>
        </div>
        
        <div id="list-container" style="padding-bottom: 80px;"></div>
    </div>

    <script>
        // --- DATA STATE ---
        let currentSettings = { type: '', style: '', count: 4 };
        let activeList = []; // Array of sections [{cat: '...', items: ['...']}]
        let isEditing = false;
        let historyStack = ['home-screen'];

        // --- TEMPLATES DATABASE ---
        const TEMPLATES = {
            land: {
                cooking: [
                    { cat: "Ø§Ù„Ù…Ù‚Ø§Ø¶ÙŠ", items: ["Ù„Ø­Ù…/Ø¯Ø¬Ø§Ø¬ (250Ø¬ Ù„Ù„Ø´Ø®Øµ)", "Ø±Ø² (Ù†Øµ ÙƒÙˆØ¨ Ù„Ù„Ø´Ø®Øµ)", "Ø¨ØµÙ„ ÙˆØ·Ù…Ø§Ø·Ù…", "Ø¨Ù‡Ø§Ø±Ø§Øª ÙˆÙ…Ù„Ø­", "Ø²ÙŠØª", "Ù…Ø§Ø¡ Ø·Ø¨Ø®"] },
                    { cat: "Ø¹Ø¯Ø© Ø§Ù„Ø·Ø¨Ø®", items: ["Ù‚Ø¯Ø± Ø·Ø¨Ø®", "Ù…ØºØ±ÙØ© ÙˆÙ…Ù„Ø§Ø³", "Ø³ÙƒÙŠÙ† ÙˆÙ„ÙˆØ­ ØªÙ‚Ø·ÙŠØ¹", "ØµØ­ÙˆÙ† ÙˆÙ…Ù„Ø§Ø¹Ù‚", "Ø³ÙØ±Ø© Ø·Ø¹Ø§Ù…", "Ø¯Ø§ÙÙˆØ± ÙƒØ¨ÙŠØ±/ØºØ§Ø²"] },
                    { cat: "Ø§Ù„Ù…Ø¹Ø§Ù…ÙŠÙ„", items: ["Ù‚Ù‡ÙˆØ© Ù…Ø·Ø­ÙˆÙ†Ø©", "Ù‡ÙŠÙ„ Ù…Ø·Ø­ÙˆÙ†", "Ø²Ø¹ÙØ±Ø§Ù†", "Ø´Ø§ÙŠ (ØªÙ„Ù‚ÙŠÙ…Ø©/Ø£ÙƒÙŠØ§Ø³)", "Ø³ÙƒØ±"] },
                    { cat: "Ø¹Ø²Ø¨Ø© Ø§Ù„Ù‚Ù‡ÙˆØ©", items: ["Ù„Ù‚Ù…Ø© (Ù…ÙÙˆØ§Ø­)", "Ø¯Ù„Ø© Ù‚Ù‡ÙˆØ©", "Ø¥Ø¨Ø±ÙŠÙ‚ Ø´Ø§Ù‡ÙŠ", "Ø²Ù…Ø²Ù…ÙŠØ© (ØªØ±Ù…Ø³)", "ÙÙ†Ø§Ø¬ÙŠÙ„ ÙˆØ¨ÙŠØ§Ù„Ø§Øª", "Ù…Ø§Ø¡ ØµØ­Ø©"] },
                    { cat: "Ø´Ø¨Ù‘Ø© Ø§Ù„Ø¶Ùˆ", items: ["Ø­Ø·Ø¨/ÙØ­Ù…", "ÙˆÙ„Ø§Ø¹Ø© ÙˆÙ…ÙƒØ¹Ø¨Ø§Øª", "Ù…Ù†Ù‚Ø§Ø´"] },
                    { cat: "Ø§Ù„Ø¬Ù„Ø³Ø©", items: ["ÙØ±Ø´Ø©", "Ù…Ø³Ø§Ù†Ø¯/Ù…Ø±Ø§ÙƒÙ‰", "Ù„Ù…Ø¨Ø© Ø³Ù†Ø§Ø±Ø©"] }
                ],
                prep_drinks: [
                    { cat: "Ø§Ù„Ù…Ø¹Ø§Ù…ÙŠÙ„", items: ["Ù‚Ù‡ÙˆØ© Ù…Ø·Ø­ÙˆÙ†Ø©", "Ù‡ÙŠÙ„ Ù…Ø·Ø­ÙˆÙ†", "Ø²Ø¹ÙØ±Ø§Ù†", "Ø´Ø§ÙŠ", "Ø³ÙƒØ±", "Ù…Ø§Ø¡ ØµØ­Ø©", "ØªÙ…Ø±"] },
                    { cat: "Ø¹Ø¯Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±", items: ["Ø¯Ø§ÙÙˆØ± ØµØºÙŠØ±", "Ù„Ù‚Ù…Ø© (Ù…ÙÙˆØ§Ø­)", "Ø¥Ø¨Ø±ÙŠÙ‚ Ø´Ø§Ù‡ÙŠ", "Ø¨ÙŠØ²", "Ø°Ø±Ø§ÙŠØ©"] },
                    { cat: "Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…", items: ["Ø¯Ù„Ø© Ù‚Ù‡ÙˆØ©", "Ø²Ù…Ø²Ù…ÙŠØ© Ù‚Ù‡ÙˆØ©", "Ø²Ù…Ø²Ù…ÙŠØ© Ø´Ø§Ù‡ÙŠ", "ÙÙ†Ø§Ø¬ÙŠÙ„ ÙˆØ¨ÙŠØ§Ù„Ø§Øª", "ÙƒÙŠØ³ Ù†ÙØ§ÙŠØ§Øª"] },
                    { cat: "Ø§Ù„Ø¬Ù„Ø³Ø©", items: ["ÙØ±Ø´Ø©", "Ù…Ø³Ø§Ù†Ø¯", "Ø­Ø·Ø¨ (Ø§Ø°Ø§ ÙÙŠÙ‡ Ø´Ø¨Ø©)"] }
                ],
                ready_drinks: [
                    { cat: "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª", items: ["Ø²Ù…Ø²Ù…ÙŠØ© Ù‚Ù‡ÙˆØ© (Ù…Ù„ÙŠØ§Ù†Ø©)", "Ø²Ù…Ø²Ù…ÙŠØ© Ø´Ø§ÙŠ (Ù…Ù„ÙŠØ§Ù†Ø©)", "Ù…Ø§Ø¡ Ø¨Ø§Ø±Ø¯"] },
                    { cat: "Ø³Ù†Ø§ÙƒØ³", items: ["ØªÙ…Ø±", "Ù…ÙƒØ³Ø±Ø§Øª", "ÙØ·Ø§Ø¦Ø±", "Ø´ÙŠØ¨Ø³Ø§Øª"] },
                    { cat: "Ø£ØºØ±Ø§Ø¶", items: ["ÙÙ†Ø§Ø¬ÙŠÙ„ ÙˆÙƒØ§Ø³Ø§Øª", "Ù…Ù†Ø§Ø¯ÙŠÙ„", "ÙƒÙŠØ³ Ù†ÙØ§ÙŠØ§Øª"] },
                    { cat: "Ø§Ù„Ø¬Ù„Ø³Ø©", items: ["ÙØ±Ø´Ø© Ø®ÙÙŠÙØ©", "ÙƒØ±Ø§Ø³ÙŠ"] }
                ]
            },
            sea: {
                cooking: [
                    { cat: "Ø¹Ø´Ø§Ø¡", items: ["Ø³Ù…Ùƒ/Ù…Ø´Ø§ÙˆÙŠ", "Ø®Ø¨Ø²", "Ø¨Ù‡Ø§Ø±Ø§Øª", "Ø³Ù„Ø·Ø§Øª"] },
                    { cat: "Ø´ÙˆÙŠ", items: ["Ù…Ù†Ù‚Ù„ Ø´ÙˆÙŠ", "ÙØ­Ù…", "Ø£Ø³ÙŠØ§Ø®/Ø´Ø¨Ùƒ", "Ù‡ÙˆØ§ÙŠØ©"] },
                    { cat: "Ø§Ù„Ù‚Ù‡ÙˆØ©", items: ["Ø¯Ù„Ø©", "Ù„Ù‚Ù…Ø©", "Ù‚Ù‡ÙˆØ© ÙˆÙ‡ÙŠÙ„", "ØªØ±Ø§Ù…Ø³"] },
                    { cat: "Ø¬Ù„Ø³Ø©", items: ["ÙƒØ±Ø§Ø³ÙŠ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ)", "Ø·Ø§ÙˆÙ„Ø©", "ÙØ±Ø´Ø©"] }
                ],
                prep_drinks: [
                    { cat: "Ø¹Ø²Ø¨Ø© Ø§Ù„Ù‚Ù‡ÙˆØ©", items: ["Ø¯Ø§ÙÙˆØ±", "Ù„Ù‚Ù…Ø©", "Ø¯Ù„Ø©", "Ø¥Ø¨Ø±ÙŠÙ‚ Ø´Ø§Ù‡ÙŠ", "Ø²Ù…Ø²Ù…ÙŠØ©"] },
                    { cat: "Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª", items: ["Ù‚Ù‡ÙˆØ© Ù…Ø·Ø­ÙˆÙ†Ø©", "Ù‡ÙŠÙ„", "Ø´Ø§ÙŠ ÙˆØ³ÙƒØ±", "Ù…Ø§Ø¡"] },
                    { cat: "Ø¬Ù„Ø³Ø©", items: ["ÙƒØ±Ø§Ø³ÙŠ", "Ø·Ø§ÙˆÙ„Ø© ØµØºÙŠØ±Ø©"] }
                ],
                ready_drinks: [ /* Simplified for demo */ ]
            }
        };
        TEMPLATES.chalet = TEMPLATES.land;
        // Fix empty Sea/Ready for demo safety
        if(!TEMPLATES.sea.ready_drinks) TEMPLATES.sea.ready_drinks = TEMPLATES.land.ready_drinks;


        // --- INIT ---
        window.onload = function() {
            renderSavedLists();
        };

        // --- NAVIGATION ---
        function nextScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            historyStack.push(screenId);
            updateHeader();
        }

        function goBack() {
            if (historyStack.length > 1) {
                historyStack.pop();
                let prevScreen = historyStack[historyStack.length - 1];
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(prevScreen).classList.add('active');
                updateHeader();
            }
        }

        function goToHome() {
            historyStack = ['home-screen'];
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('home-screen').classList.add('active');
            updateHeader();
            renderSavedLists(); // Refresh saved lists
        }

        function updateHeader() {
            document.querySelector('.back-btn').classList.toggle('hidden', historyStack.length <= 1);
        }

        // --- WIZARD ACTIONS ---
        function selectType(type) {
            currentSettings.type = type;
            nextScreen('style-screen');
        }

        function selectStyle(style) {
            currentSettings.style = style;
            nextScreen('count-screen');
        }

        // --- LIST GENERATION ---
        function generateNewList() {
            currentSettings.count = document.getElementById('people-count').value;
            
            // Deep copy the template to activeList
            let template = TEMPLATES[currentSettings.type]?.[currentSettings.style] || TEMPLATES.land.cooking;
            
            // Process the strings (replace count) and create a clean object
            activeList = template.map(section => {
                return {
                    cat: section.cat,
                    items: section.items.map(item => item.replace("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ", currentSettings.count))
                };
            });

            isEditing = false;
            renderList();
            nextScreen('list-screen');
        }

        // --- LIST RENDERING & EDITING ---
        function renderList() {
            const container = document.getElementById('list-container');
            container.innerHTML = "";
            const editBtn = document.getElementById('edit-btn');
            
            if(isEditing) {
                editBtn.classList.add('active-edit');
                editBtn.innerHTML = "âœ… ØªÙ…";
            } else {
                editBtn.classList.remove('active-edit');
                editBtn.innerHTML = "âœï¸ ØªØ¹Ø¯ÙŠÙ„";
            }

            activeList.forEach((section, secIdx) => {
                let html = `<div class="list-section">
                                <div class="section-title">${section.cat}</div>`;
                
                // Render Items
                section.items.forEach((item, itemIdx) => {
                    html += `<div class="list-item">`;
                    
                    if(isEditing) {
                        // Edit Mode: Delete Icon + Text
                        html += `<span>${item}</span>
                                 <span class="delete-btn" onclick="deleteItem(${secIdx}, ${itemIdx})">ğŸ—‘ï¸</span>`;
                    } else {
                        // View Mode: Text + Checkbox
                        html += `<span>${item}</span>
                                 <input type="checkbox" style="width:20px; height:20px;">`;
                    }
                    html += `</div>`;
                });

                // Edit Mode: Add new item input
                if(isEditing) {
                    html += `<div class="add-row">
                                <input type="text" placeholder="ØºØ±Ø¶ Ø¬Ø¯ÙŠØ¯..." class="add-input" id="new-item-${secIdx}">
                                <button class="add-btn-small" onclick="addItem(${secIdx})">ï¼‹</button>
                             </div>`;
                }

                html += `</div>`;
                container.innerHTML += html;
            });
        }

        function toggleEditMode() {
            isEditing = !isEditing;
            renderList();
        }

        function deleteItem(secIdx, itemIdx) {
            activeList[secIdx].items.splice(itemIdx, 1);
            renderList();
        }

        function addItem(secIdx) {
            const input = document.getElementById(`new-item-${secIdx}`);
            const val = input.value.trim();
            if(val) {
                activeList[secIdx].items.push(val);
                renderList(); 
            }
        }

        // --- SAVING & LOADING ---
        function saveCurrentList() {
            let name = prompt("ÙˆØ´ Ø­Ø§Ø¨ ØªØ³Ù…ÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ", "ÙƒØ´ØªØ© Ø§Ù„Ø¬Ù…Ø¹Ø©");
            if(name) {
                let saved = JSON.parse(localStorage.getItem('keshta_saved') || "[]");
                saved.push({
                    id: Date.now(),
                    name: name,
                    date: new Date().toLocaleDateString('ar-SA'),
                    list: activeList,
                    count: currentSettings.count
                });
                localStorage.setItem('keshta_saved', JSON.stringify(saved));
                alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
                goToHome();
            }
        }

        function renderSavedLists() {
            const container = document.getElementById('saved-list-container');
            let saved = JSON.parse(localStorage.getItem('keshta_saved') || "[]");
            
            if(saved.length === 0) {
                container.innerHTML = `<div class="empty-state">Ù…Ø§ ÙÙŠÙ‡ ÙƒØ´Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>`;
                return;
            }

            container.innerHTML = "";
            // Show newest first
            saved.reverse().forEach((list, index) => {
                // Adjust index for original array
                let realIndex = saved.length - 1 - index; 
                
                let html = `<div class="saved-item">
                                <div onclick="loadSavedList(${realIndex})" style="flex:1; cursor:pointer;">
                                    <div class="saved-info">
                                        <h4>${list.name}</h4>
                                        <span>ğŸ“… ${list.date} â€¢ ğŸ‘¥ ${list.count} Ø£Ø´Ø®Ø§Øµ</span>
                                    </div>
                                </div>
                                <button class="delete-saved-btn" onclick="deleteSavedList(${realIndex})">ğŸ—‘ï¸</button>
                            </div>`;
                container.innerHTML += html;
            });
        }

        function loadSavedList(index) {
            let saved = JSON.parse(localStorage.getItem('keshta_saved'));
            activeList = saved[index].list;
            currentSettings.count = saved[index].count;
            
            isEditing = false;
            renderList();
            nextScreen('list-screen');
        }

        function deleteSavedList(index) {
            if(confirm("Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ù‡Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ")) {
                let saved = JSON.parse(localStorage.getItem('keshta_saved'));
                saved.splice(index, 1);
                localStorage.setItem('keshta_saved', JSON.stringify(saved));
                renderSavedLists();
            }
        }

        // --- COPY ---
        function copyToClipboard() {
            let text = `ğŸ•ï¸ *Ù‚Ø§Ø¦Ù…Ø© ÙƒØ´ØªØ©: ${currentSettings.count} Ø£Ø´Ø®Ø§Øµ*\n\n`;
            activeList.forEach(section => {
                if(section.items.length > 0) {
                    text += `*${section.cat}*\n`;
                    section.items.forEach(item => text += `- ${item}\n`);
                    text += `\n`;
                }
            });
            text += `_ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ² Ø¹Ø¨Ø± ØªØ·Ø¨ÙŠÙ‚ ÙƒØ´ØªØ©_`;
            navigator.clipboard.writeText(text).then(() => alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù„Ù„ÙˆØ§ØªØ³! âœ…"));
        }
    </script>
</body>
</html>